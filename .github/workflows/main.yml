# name: Docker CI/CD Pipeline

# on:
#   push:
#     branches: [main, develop]
#   pull_request:
#     branches: [main, develop]
#   workflow_dispatch:

# concurrency:
#   group: ${{ github.workflow }}-${{ github.ref }}
#   cancel-in-progress: true

# env:
#   NODE_VERSION: "24.11.1"
#   DOCKERHUB_REPO: ${{ secrets.DOCKER_USERNAME }}/${{ secrets.DOCKERHUB_PROJECT_NAME }}

# jobs:
#   # Step 1: Code Quality Checks
#   lint:
#     name: Lint Code
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}
#           cache: npm

#       - name: Install dependencies
#         run: npm ci

#       - name: Run ESLint
#         run: npm run lint

#   # Step 2: Run Tests
#   test:
#     name: Run Tests
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: ${{ env.NODE_VERSION }}
#           cache: npm

#       - name: Install dependencies
#         run: npm ci

#       - name: Run tests with coverage
#         run: npm run test:coverage

#       - name: Upload coverage reports
#         uses: actions/upload-artifact@v4
#         if: always()
#         with:
#           name: coverage-report
#           path: coverage/
#           retention-days: 7

#   # Step 3: Build and Deploy (only on main branch)
#   build-and-deploy:
#     name: Build & Deploy to Docker Hub
#     runs-on: ubuntu-latest
#     needs: [lint, test]

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Set up QEMU
#         uses: docker/setup-qemu-action@v3

#       - name: Set up Docker Buildx
#         uses: docker/setup-buildx-action@v3

#       - name: Extract metadata
#         id: meta
#         run: |
#           echo "short_sha=${GITHUB_SHA::7}" >> "$GITHUB_OUTPUT"
#           echo "date=$(date +'%Y%m%d')" >> "$GITHUB_OUTPUT"

#       - name: Log in to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: Build and push production image
#         uses: docker/build-push-action@v6
#         with:
#           context: .
#           file: Dockerfile
#           push: true
#           platforms: linux/amd64,linux/arm64
#           tags: |
#             ${{ env.DOCKERHUB_REPO }}:latest
#             ${{ env.DOCKERHUB_REPO }}:${{ steps.meta.outputs.short_sha }}
#             ${{ env.DOCKERHUB_REPO }}:${{ steps.meta.outputs.date }}
#           cache-from: type=gha
#           cache-to: type=gha,mode=max
